<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>RFC 7690 - Close Encounters of the ICMP Type 2 Kind (Near Misses with ICMPv6 Packet Too Big (PTB)) 日本語訳</title>

  <link rel="shortcut icon" type="image/x-icon"
    href="https://tex2e.github.io/rfc-translater/favicon.ico" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <link rel="stylesheet" href="master.css">
  <script src="index.js"></script>

  <script>
    var host = window.location.hostname;
    if (host != "localhost") {
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-75892425-1', 'auto');
      ga('send', 'pageview');
    }
  </script>

</head>
<body>
  <nav class="navbar navbar-expand navbar-light bg-light">
    <a class="navbar-brand" href="index.html">RFC Trans</a>
    <div class="collapse navbar-collapse" id="navbarText">
      <div class="navbar-nav mr-auto">
        <a class="nav-item nav-link" href="privacy-policy.html">Privacy Policy</a>
        <a class="nav-item nav-link" href="contact.html">Contact</a>
      </div>
      <div class="navbar-nav ml-auto">
        <span class="navbar-text"><small>@tex2e</small></span>
      </div>
    </div>
  </nav>

  <span id="rfc_number" class="hidden">7690</span>
  <div style="height: 1ex;"></div>
  <div class="container">
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <div class="alert alert-info" role="alert">
          <h4 class="alert-heading">RFC 7690 - Close Encounters of the ICMP Type 2 Kind (Near Misses with ICMPv6 Packet Too Big (PTB)) 日本語訳</h4>
          <span class="URL">URL :
            <a href="https://tools.ietf.org/html/rfc7690">
              https://tools.ietf.org/html/rfc7690
            </a>
          </span><br>
          <span class="title_ja">
            タイトル : <strong>RFC 7690 - ICMPタイプ2種類（ICMPv6の巨大パケット（PTB）とのニアミス）のクローズ出会い</strong></span><br>
          <span class="updated_by">翻訳編集 : 自動生成</span><br>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
Internet Engineering Task Force (IETF)                         M. Byerly
Request for Comments: 7690                                        Fastly
Category: Informational                                          M. Hite
ISSN: 2070-1721                                                 Evernote
                                                              J. Jaeggli
                                                                  Fastly
                                                            January 2016
        </pre>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
                Close Encounters of the ICMP Type 2 Kind
             (Near Misses with ICMPv6 Packet Too Big (PTB))
        </pre>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Abstract
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
抽象
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document calls attention to the problem of delivering ICMPv6 type 2 &#34;Packet Too Big&#34; (PTB) messages to the intended destination (typically the server) in ECMP load-balanced or anycast network architectures. It discusses operational mitigations that can be employed to address this class of failures.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
この文書では、ECMPロードバランスやエニーキャストネットワークアーキテクチャに意図された目的地（通常はサーバー）への「パケット過大」（PTB）メッセージをICMPv6のタイプ2を提供する問題に対して注意を促します。これは、障害のこのクラスに対処するために使用することができる運用の緩和策について説明します。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Status of This Memo
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
このメモのステータス
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document is not an Internet Standards Track specification; it is published for informational purposes.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントはインターネット標準化過程仕様ではありません。それは、情報提供の目的のために公開されています。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document is a product of the Internet Engineering Task Force (IETF). It represents the consensus of the IETF community. It has received public review and has been approved for publication by the Internet Engineering Steering Group (IESG). Not all documents approved by the IESG are a candidate for any level of Internet Standard; see Section 2 of RFC 5741.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントはインターネットエンジニアリングタスクフォース（IETF）の製品です。これは、IETFコミュニティの総意を表しています。これは、公開レビューを受けており、インターネットエンジニアリング運営グループ（IESG）によって公表のために承認されています。 IESGによって承認されていないすべての文書がインターネットStandardのどんなレベルの候補です。 RFC 5741のセクション2を参照してください。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Information about the current status of this document, any errata, and how to provide feedback on it may be obtained at http://www.rfc-editor.org/info/rfc7690.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このドキュメントの現在の状態、任意の正誤表、そしてどのようにフィードバックを提供するための情報がhttp://www.rfc-editor.org/info/rfc7690で取得することができます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Copyright Notice
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
著作権表示
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Copyright (c) 2016 IETF Trust and the persons identified as the document authors. All rights reserved.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
著作権（C）2016 IETF信託とドキュメントの作成者として特定の人物。全著作権所有。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This document is subject to BCP 78 and the IETF Trust&#39;s Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
この文書では、BCP 78と、この文書の発行日に有効なIETFドキュメント（http://trustee.ietf.org/license-info）に関連IETFトラストの法律の規定に従うものとします。彼らは、この文書に関してあなたの権利と制限を説明するように、慎重にこれらの文書を確認してください。コードコンポーネントは、トラスト法規定のセクションで説明4.eおよび簡体BSDライセンスで説明したように、保証なしで提供されているよう簡体BSDライセンスのテキストを含める必要があり、この文書から抽出されました。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Table of Contents
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
目次
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Problem . . . . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Mitigation  . . . . . . . . . . . . . . . . . . . . . . . . .   4
     3.1.  Alternative Mitigations . . . . . . . . . . . . . . . . .   5
     3.2.  Implementation  . . . . . . . . . . . . . . . . . . . . .   5
       3.2.1.  Alternative Implementation  . . . . . . . . . . . . .   6
   4.  Improvements  . . . . . . . . . . . . . . . . . . . . . . . .   7
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   8
   6.  Informative References  . . . . . . . . . . . . . . . . . . .   8
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .   9
   Authors&#39; Addresses  . . . . . . . . . . . . . . . . . . . . . . .   9
        </pre>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
1. Introduction
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
1. はじめに
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Operators of popular Internet services face complex challenges associated with scaling their infrastructure. One scaling approach is to utilize equal-cost multipath (ECMP) routing to perform stateless distribution of incoming TCP or UDP sessions to multiple servers or to middle boxes such as load balancers. Distribution of traffic in this manner presents a problem when dealing with ICMP signaling. Specifically, an ICMP error is not guaranteed to hash via ECMP to the same destination as its corresponding TCP or UDP session. A case where this is particularly problematic operationally is path MTU discovery (PMTUD) [RFC1981].
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
人気のインターネットサービスの事業者がインフラのスケーリングに関連した複雑な課題に直面しています。一つのスケーリングアプローチは、複数のサーバーに、またはそのようなロードバランサとして中央ボックスに入って来るTCPまたはUDPセッションのステートレス分布を実行する等価コストマルチパス（ECMP）ルーティングを利用することです。 ICMPシグナリングを扱うときに、このようにトラフィックの配布は問題があります。具体的には、ICMPエラーは、対応するTCPまたはUDPセッションと同じ宛先へのECMPを介してハッシュすることが保証されません。これが特に問題となる場合は、運用パスMTUディスカバリ（PMTUD）[RFC1981]です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
2. Problem
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
2.問題
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A common application for stateless load balancing of TCP or UDP flows is to perform an initial subdivision of flows in front of a stateful load-balancer tier or multiple servers so that the workload becomes divided into manageable fractions of the total number of flows. The flow division is performed using ECMP forwarding and a stateless but sticky algorithm for hashing across the available paths (see [RFC2991] for background on ECMP routing). For the purposes of flow distribution, this next-hop selection is a constrained form of anycast topology, where all anycast destinations are equidistant from the upstream router responsible for making the last next-hop forwarding decision before the flow arrives on the destination device. In this approach, the hash is performed across some set of available protocol headers. Typically, these headers may include all or a subset of (IPv6) Flow-Label, IP-source, IP-destination, protocol, source-port, destination-port, and potentially others such as ingress interface.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
TCPまたはUDPのステートレス・ロード・バランシングのための一般的なアプリケーションフローワークロードフローの総数の管理画分に分割になるようにステートフルな負荷分散の層または複数のサーバの前にフローの最初の細分割を実行することです。流れ分割は（ECMPルーティング上の背景に[RFC2991]を参照）ECMP転送し、利用可能なパス全体ハッシュのステートレスが、粘着性アルゴリズムを使用して実行されます。流れ分布のために、このネクストホップの選択は、すべてのエニーキャスト先がフローが宛先デバイスに到着する前の最後のネクストホップフォワーディング決定を行うための責任上流のルータから等距離にあるエニーキャストトポロジの制約形式です。このアプローチでは、ハッシュは、利用可能なプロトコルヘッダの一部セットにわたって実行されます。典型的には、これらのヘッダは、（IPv6）のフローラベル、IPソース、IP宛先、プロトコル、送信元ポート、宛先ポート、および潜在的に入力インターフェイスのような他のすべてまたはサブセットを含むことができます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A problem common to this approach of distribution through hashing is impact on path MTU discovery. An ICMPv6 type 2 PTB message generated on an intermediate device for a packet sent from a server that is part of an ECMP load-balanced service to a client will have the load-balanced anycast address as the destination and hence will be statelessly load balanced to one of the servers. While the ICMPv6 PTB message contains as much of the packet that could not be forwarded as possible, the payload headers are not considered in the forwarding decision and are ignored. Because the PTB message is not identifiable as part of the original flow by the IP or upper-layer packet headers, the results of the ICMPv6 ECMP hash calculation are unlikely to be hashed to the same next hop as packets matching the TCP or UDP ECMP hash of the flow.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ハッシュスルー分布のこのアプローチに共通する問題は、パスMTU探索の影響です。クライアントにECMPの負荷分散サービスの一部であるサーバから送信されたパケットのための中間デバイス上で発生するICMPv6タイプ2 PTBメッセージは、宛先として、負荷バランスエニーキャストアドレスを持つことになり、従って、ステートレスに負荷分散しますサーバの一つ。 ICMPv6のPTBメッセージを可能として転送することができなかったパケットの多くを含んでいるが、ペイロードヘッダは転送決定で考慮されていないと無視されます。 PTBメッセージはIPまたは上位層パケットのヘッダによって元のフローの一部として識別可能ではないので、ICMPv6のECMPハッシュ計算の結果は、TCPまたはUDP ECMPハッシュに一致するパケットと同じ次ホップにハッシュされにくいです流れの。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
An example packet flow and topology follow. The packet for which the PTB message was generated was intended for the client.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
例えば、パケットの流れとトポロジが続きます。 PTBメッセージが生成されたパケットは、クライアントのために意図されていました。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ptb -&gt; router ecmp -&gt; next hop L4/L7 load balancer -&gt; destination
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
PTB  - &gt;ルータECMP  - &gt;ネクストホップL4 / L7ロードバランサ - &gt;先
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
     router --&gt; load balancer 1 ---&gt;
          \\--&gt; load balancer 2 ---&gt; load-balanced service
           \--&gt; load balancer N ---&gt;
        </pre>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-33">
Figure 1
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-33">
図1
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The router ECMP decision is used because it is part of the forwarding architecture, can be performed at line rate, and does not depend on shared state or coordination across a distributed forwarding system that may include multiple linecards or routers. The ECMP routing decision is deterministic with respect to packets having the same computed hash.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ルータECMP決定は、それが転送アーキテクチャの一部であるため、使用されるライン速度で行うことができ、複数のラインカードまたはルータを含むことができる分散転送システムの間で共有状態または配位に依存しません。 ECMPルーティング決定は、同じ計算されたハッシュを持つパケットに対して決定的です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A typical case in which ICMPv6 PTB messages are received at the load balancer is where the path MTU from the client to the load balancer is limited by a tunnel of which the client itself is not aware.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ロードバランサに、クライアントからの経路MTUは、クライアント自身が認識していないとなっているトンネルによって制限されるのICMPv6 PTBメッセージは、ロード・バランサで受信された典型的なケースです。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Direct experience says that the frequency of PTB messages is small compared to total flows. One possible conclusion is that tunneled IPv6 deployments that cannot carry 1500 MTU packets are relatively rare. Techniques employed by clients (e.g., Happy Eyeballs [RFC6555]) may actually contribute some amelioration to the IPv6 client experience by preferring IPv4 in cases that might be identified as failures. Still, the expectation of operators is that PMTUD should work and that unnecessary breakage of client traffic should be avoided.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
直接経験はPTBメッセージの頻度は、総フローに比べて小さいことを言います。一つの可能​​な結論は1500個のMTUパケットを運ぶことができない、トンネリングIPv6の展開は比較的まれであるということです。クライアント（例えば、ハッピー眼球[RFC6555]）によって使用される技術は、実際の障害として識別される可能性があります場合にはIPv4を好むことにより、IPv6クライアントの経験にいくつかの改善を寄与することができます。それでも、事業者の期待はPMTUDが動作し、クライアントトラフィックの不要な破損を避けるべきであることをすべきであるということです。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A final observation regarding server tuning is that it is not always possible, even if it is potentially desirable to be able to independently set the TCP MSS (Maximum Segment Size) for different address families on some end systems. On Linux platforms, advmss (advertised mss) may be set on a per-route basis for selected destinations in cases where discrimination by route is possible.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
サーバーのチューニングに関する最終的観測は、独立して、いくつかのエンドシステム上の異なるアドレスファミリのTCP MSS（最大セグメントサイズ）を設定できるように潜在的に望まれる場合でも、それは常に可能ではないということです。 Linuxプラットフォームで、advmss（アドバタイズMSS）は経路による識別が可能である場合には選択された目的地ごとの経路に基づいて設定してもよいです。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The problem as described does also impact IPv4; however, implementation of RFC 4821 [RFC4821] TCP MTU probing, the ability to fragment on the wire at tunnel ingress points, and the relative rarity of sub-1500-byte MTUs that are not coupled to changes in client behavior (for example, endpoint VPN clients set the tunnel interface MTU accordingly to avoid fragmentation for performance reasons) makes the problem sufficiently rare that some existing deployments have chosen to ignore it.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
説明したような問題はまた、IPv4の影響を与えません。しかしながら、RFC 4821の実装[RFC4821] TCP MTUプロービング、トンネル入口点でワイヤーに断片化する能力、およびクライアントの動作の変化（例えば、エンドポイントに結合されていないサブ1500バイトのMTUの相対的希少VPNクライアント）は、パフォーマンス上の理由から断片化を避けるために、それに応じてトンネルインターフェイスのMTUを設定するいくつかの既存の展開がそれを無視することを選択したことを十分にまれな問題になります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3. Mitigation
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.軽減
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Mitigation of the potential for PTB messages to be misdelivered involves ensuring that an ICMPv6 error message is distributed to the same anycast server responsible for the flow for which the error is generated. With appropriate hardware support, flows could be identified using the same technique as hosts by inspecting the payload of the ICMPv6 message. The ECMP hash calculation can then be performed using values identified from the inner TCP flow parameters of the ICMPv6 message. Because the encapsulated IP header occurs at a fixed offset in the ICMP message, it is not outside the realm of possibility that routers with sufficient header processing capability could parse that far into the payload. Employing a mediation device that handles the parsing and distribution of PTB messages after policy routing or on each load balancer / server is a possibility.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
誤配送するPTBメッセージの電位の緩和は、ICMPv6エラーメッセージは、エラーが生成されたフローを担う同じエニーキャストサーバに分配されることを確実にすることを含みます。適切なハードウェアサポートと、フローは、ICMPv6メッセージのペイロードを検査することによってホストと同様の手法を用いて同定することができます。 ECMPハッシュ計算は、次に、ICMPv6メッセージの内側TCPフロー・パラメータから特定の値を使用して行うことができます。カプセル化IPヘッダがICMPメッセージに固定オフセットで発生するので、十分なヘッダ処理能力を有するルータはその遠ペイロードに解析できた可能性の領域外ではありません。ポリシールーティングの後、または各ロードバランサ/サーバ上のPTBメッセージの解析および分布を扱う仲介装置を使用することは可能です。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Another mitigation approach is predicated upon distributing the PTB message to all anycast servers under the assumption that the one for which the message was intended will be able to match it to the flow and update the route cache with the new MTU and that devices not able to match the flow will discard these packets. Such distribution has potentially significant implications for resource consumption and for self-inflicted denial of service (DOS) if not carefully employed. Fortunately, we have observed that the number of flows for which this problem occurs is relatively small in real-world deployments (for example, 10 or fewer pps on 1 Gbit/s or more worth of HTTPS); sensible ingress rate limiters that will discard excessive message volume can be applied to protect even very large anycast server tiers with the potential for fallout limited to circumstances of deliberate duress.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
別の緩和アプローチはにできませんデバイスのメッセージが意図された1が、流れにそれを一致して、新しいMTUを持つルートキャッシュを更新することができるようになりますという仮定の下で、すべてのエニーキャストサーバにPTBメッセージを配布するとしていることを前提としていますこれらのパケットを破棄します流れにマッチ。慎重に使用していない場合、このような分布は、資源消費のためのサービス（DOS）の自ら招い拒否の潜在的に重要な意味を持っています。幸いなことに、我々はこの問題が発生するためにフローの数は、実世界での展開で比較的小さいことを観察している（例えば、10の以下の1ギガビット/秒のPPSまたはHTTPSのより価値があります）。過剰なメッセージボリュームを廃棄する賢明な入力レートリミッタは、意図的な強迫の状況に限定されるもので降下物のための潜在的であっても非常に大きなエニーキャストサーバの階層を保護するために適用することができます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.1. Alternative Mitigations
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.1. 代替た軽減
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
As an alternative, it may be appropriate to lower the TCP MSS to 1220 in order to accommodate 1280-byte MTU. We consider this undesirable, as hosts may not be able to independently set TCP MSS by address family thereby impacting IPv4, or alternatively that middle-boxes need to be employed to clamp the MSS independently from the end systems. Potentially, extension headers might further alter the lower bound that the MSS would have to be set to, making clamping even more undesirable.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
代替として、1280バイトのMTUに対応するために1220年にTCP MSSを低下させるために適切であり得ます。ホストは独立してアドレスファミリはそれによってはIPv4に影響を与える、あるいはその中間のボックスはエンドシステムから独立してMSSをクランプするために使用される必要があることにより、TCP MSSを設定することができないかもしれないとして、我々は、これは望ましくない考えます。潜在的には、拡張ヘッダは、さらに下限MSSを作り、さらに望ましくないクランプ、に設定されなければならないことを変えるかもしれません。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.2. Implementation
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.2. 実装
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1. Filter-based forwarding matches next-header ICMPv6 type 2 and matches a next hop on a particular subnet directly attached to one or more routers. The filter is policed to reasonable limits (we chose 1000 pps; more conservative rates might be required in other implementations).
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1.フィルタベースの転送は、次のヘッダーのICMPv6タイプ2と一致し、直接1つまたは複数のルータに取り付けられた特定のサブネット上の次のホップに一致します。フィルタは、合理的な範囲にポリシングされ（私たちは1000年、PPSを選んだ。より保守的な速度は、他の実装に必要になる場合があります）。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2. The filter is applied on the input side of all external (Internet- or customer-facing) interfaces.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2.フィルタはすべての外部（Internet-または顧客向け）インターフェースの入力側に印加されます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
3. A proxy located at the next hop forwards ICMPv6 type 2 packets it receives to an Ethernet broadcast address (example ff:ff:ff:ff:ff:ff) on all specified subnets. This was necessitated by router inability (in IPv6) to forward the same packet to multiple unicast next hops.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
指定されたすべてのサブネットに転送するネクストホップのICMPv6タイプがイーサネットブロードキャストアドレス（FF：FF：FF：FF：FF例FF）を受信する2つのパケットに位置3.プロキシ。これは、複数のユニキャスト次のホップへの同じパケットを転送する（IPv6における）ルータできないことによって必要とされました。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
4. Anycasted servers receive the PTB error and process the packet as needed.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
4. Anycastedサーバは、PTBのエラーが表示され、必要に応じてパケットを処理します。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
A simple Python scapy [SCAPY] script that can perform the ICMPv6 proxy reflection is included.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ICMPv6のプロキシ反射を行うことができる簡単なPythonのscapy [SCAPY]スクリプトが含まれています。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
#!/usr/bin/python
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
＃！は/ usr / binに/ pythonの
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
from scapy.all import *
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
scapy.allインポートから*
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
IFACE_OUT = [&#34;p2p1&#34;, &#34;p2p2&#34;]
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
IFACE_OUT = [ &#34;p2p1&#34;、 &#34;p2p2&#34;]
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
def icmp6_callback(pkt): if pkt.haslayer(IPv6) and (ICMPv6PacketTooBig in pkt) \ and pkt[Ether].dst != &#39;ff:ff:ff:ff:ff:ff&#39;: del(pkt[Ether].src) pkt[Ether].dst = &#39;ff:ff:ff:ff:ff:ff&#39; pkt.show() for iface in IFACE_OUT: sendp(pkt, iface=iface)
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
もしpkt.haslayer（IPv6）の及び（PKTでICMPv6PacketTooBig）\とPKT [エーテル] DST = &#39;FF：FF：FF：FF：FF：FF&#39;：デル（PKT [エーテル] DEF（PTS）をicmp6_callback。 SRC）PKT [エーテル] DST = &#39;FF：FF：FF：FF：FF：FF&#39; pkt.show（）IFACE_OUTでのiface用：sendp（PKT、IFACE = IFACE）
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
def main(): sniff(prn=icmp6_callback, filter=&#34;icmp6 \ and (ip6[40+0] == 2)&#34;, store=0)
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
DEFメイン（）：スニフ（PRN = icmp6_callback、フィルタ= &#34;ICMP6の\と（IP6 [40 + 0] == 2）&#34;、店舗= 0）
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
if __name__ == &#39;__main__&#39;: main()
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-9">
もし__name__ == &#39;__main__&#39;：メイン（）
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
This example script listens on all interfaces for IPv6 PTB errors being forwarded using filter-based forwarding. It removes the existing Ethernet source and rewrites a new Ethernet destination of the Ethernet broadcast address. It then sends the resulting frame out the p2p1 and p2p2 interfaces that are attached to VLANs where our anycast servers reside.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
このスクリプト例は、フィルターベースの転送を使用して転送されたIPv6 PTBエラーのすべてのインターフェイスをリッスン。これは、既存のイーサネットソースを削除し、イーサネットブロードキャストアドレスの新しいイーサネット宛先を書き換えます。その後、私たちのエニーキャストサーバーが存在VLANに接続されているp2p1とp2p2インタフェースアウト結果のフレームを送信します。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.2.1. Alternative Implementation
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
3.2.1. 代替実装
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Alternatively, network designs in which a common layer 2 network exists on the ECMP hop could distribute the proxy onto the end systems, eliminating the need for policy routing. They could then rewrite the destination -- for example, using iptables before forwarding the packet back to the network containing all of the server or load-balancer interfaces. This implementation can be done entirely within the Linux iptables firewall. Because of the distributed nature of the filter, more conservative rate limits are required than when a global rate limit can be employed.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
代替的に、共通のレイヤ2ネットワークは、ECMPホップ上に存在するネットワークの設計は、ポリシールーティングの必要性を排除し、エンドシステムにプロキシを配布することができました。彼らは、宛先を書き換えることができ - 例えば、バックサーバまたはロードバランサインターフェイスのすべてを含むネットワークにパケットを転送する前にiptablesの使用します。この実装は、Linuxのiptablesファイアウォール内に完全に行うことができます。なぜならフィルタの分散性質のため、より保守的なレート制限は、グローバルレート制限を使用することができる場合よりも、必要とされます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
An example ip6tables/nftables rule to match icmp6 traffic, not match broadcast traffic, impose a rate limit of 10 pps, and pass to a target destination would resemble:
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
例えばip6tablesを/ nftablesは似ているであろう、ICMP6トラフィックに一致するブロードキャストトラフィックと一致しない、10のPPSのレート制限を課し、ターゲット宛先に渡すルール：
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12">
        <pre class="text text-monospace">
       ip6tables -I INPUT -i lo -p icmpv6 -m icmpv6 --icmpv6-type 2/0 \
       -m pkttype ! --pkt-type broadcast -m limit --limit 10/second \
       -j TEE 2001:DB8::1
        </pre>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
As with the scapy example, once the destination has been rewritten from a hardcoded ND entry to an Ethernet broadcast address -- in this case to an IPv6 documentation address -- the traffic will be reflected to all the hosts on the subnet.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
宛先イーサネットブロードキャストアドレスにハードコードNDエントリから書き換えられた後scapy例と同様に、 - この場合、IPv6のマニュアルアドレスに - トラフィックは、サブネット上のすべてのホストに反映されます。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
4. Improvements
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
4.改善
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
There are several ways that improvements could be made to improve handling ECMP load balancing of ICMPv6 PTB messages. Little in the way of change to the Internet protocol specification is required; rather, we foresee practical implementation change, which, insofar as we are aware, does not exist in current router, switch, or layer 3/4 load balancers. Alternatively, improved behavior on the part of client/server detection of path MTU in band could render the behavior of devices in the path irrelevant.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
改善がICMPv6のPTBメッセージの取り扱いECMPの負荷分散を改善するために作ることができるいくつかの方法があります。インターネットプロトコル仕様への変更の仕方ではほとんど必要とされます。むしろ、我々は認識しているとして、現在のルータ、スイッチ、またはレイヤ3/4ロードバランサに存在しない限り、実用的な実装の変更を、予見します。あるいは、バンド内のパスMTUのクライアント/サーバの検出の一部に改善された挙動は無関係な経路内のデバイスの動作をレンダリングすることができました。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
1. Routers with sufficient capacity within the lookup process could parse all the way through the L3 or L4 header in the ICMPv6 payload beginning at bit offset 32 of the ICMP header. By reordering the elements of the hash to match the inward direction of the flow, the PTB error could be directed to the same next hop as the incoming packets in the flow.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
すべての方法のビットで始まるICMPv6のペイロード内L3又はL4ヘッダを解析できたルックアップ・プロセス内に十分な容量を持つ1ルータは、ICMPヘッダの32をオフセット。流れの内側方向と一致するハッシュの要素を並べ替えることにより、PTB誤差は、フロー内の着信パケットと同じ次のホップに向けることができました。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2. The FIB (Forwarding Information Base) on the router could be programmed with a multicast distribution tree that includes all of the necessary next hops, and unicast ICMPv6 packets could be policy routed to these destinations.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
2.ルータ上のFIB（転送情報ベース）は、必要に応じて、次のホップのすべてを含んでマルチキャスト配信ツリーをプログラムすることができ、およびユニキャストのICMPv6パケットは、これらの宛先にルーティングポリシーである可能性があります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
3. Ubiquitous implementation of RFC 4821 [RFC4821] Packetization Layer Path MTU Discovery would probably go a long way towards reducing dependence on ICMPv6 PTB by end systems.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
RFC 4821 [RFC4821]パケット化レイヤのパスMTUディスカバリーの3ユビキタス実装は、おそらくエンドシステムでのICMPv6 PTBへの依存を減らすことに向けて長い道のりを行くだろう。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
5. Security Considerations
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
5.セキュリティについての考慮事項
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The employed mitigation has the potential to greatly amplify the impact of a deliberately malicious sending of ICMPv6 PTB messages. Sensible ingress rate limiting can reduce the potential for impact; legitimate PMTUD messages may be lost once the rate limit is reached. The scenario where drops of legitimate traffic occur is analogous to other cases where DOS traffic can crowd out legitimate traffic, however only a limited subset of overall traffic is impacted.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
使用緩和が大幅のICMPv6 PTBメッセージの送信を意図的に悪意のあるの影響を増幅する可能性を有します。制限賢明な進入率は影響の可能性を減らすことができます。レート制限に達すると、正当なPMTUDのメッセージが失われる可能性があります。正当なトラフィックのドロップが発生するシナリオは、DoSトラフィックしかしのみ全体的なトラフィックの限られたサブセットが影響され、正当なトラフィックを群衆ができ、他の場合に類似しています。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The proxy replication results in all devices on the subnet receiving ICMPv6 PTB errors, even those not associated with the flow. This could arguably result in information disclosure due to the wide replication of the ICMPv6 PTB error on the subnet and the large fragment of the offending IP packet embedded in the ICMPv6 error. Because of this, recipient machines should be in a common administrative domain.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ICMPv6のPTBエラー、フローに関連付けられていないものも含めを受け、サブネット上のすべてのデバイスでプロキシ複製結果。これは間違いなく原因サブネット上のICMPv6 PTBエラーの広い複製およびICMPv6エラーに埋め込まれ、問題のあるIPパケットの大断片に情報開示につながる可能性があります。このため、受信者のマシンは、共通の管理ドメインにする必要があります。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
6. Informative References
        </h5>
      </div>
      <div class="col-sm-12 col-md-6">
        <h5 class="text mt-2">
6.参考文献
        </h5>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC1981] McCann, J., Deering, S., and J. Mogul, &#34;Path MTU Discovery for IP version 6&#34;, RFC 1981, DOI 10.17487/RFC1981, August 1996, &lt;http://www.rfc-editor.org/info/rfc1981&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC1981]マッキャン、J.、デアリング、S.、およびJ.ムガール人、RFC 1981 &#34;IPバージョン6のパスMTUディスカバリー&#34;、DOI 10.17487 / RFC1981、1996年8月、&lt;のhttp：//www.rfc-editor。組織/情報/ rfc1981&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC2991] Thaler, D. and C. Hopps, &#34;Multipath Issues in Unicast and Multicast Next-Hop Selection&#34;, RFC 2991, DOI 10.17487/RFC2991, November 2000, &lt;http://www.rfc-editor.org/info/rfc2991&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC2991]ターラー、D.およびC. Hoppsが、 &#34;ユニキャストとマルチキャストの次ホップの選択におけるマルチパスの問題&#34;、RFC 2991、DOI 10.17487 / RFC2991、2000年11月、&lt;http://www.rfc-editor.org/info / rfc2991&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC4821] Mathis, M. and J. Heffner, &#34;Packetization Layer Path MTU Discovery&#34;, RFC 4821, DOI 10.17487/RFC4821, March 2007, &lt;http://www.rfc-editor.org/info/rfc4821&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC4821]マシス、M.とJ. Heffner、 &#34;パケット化レイヤのパスMTUディスカバリ&#34;、RFC 4821、DOI 10.17487 / RFC4821、2007年3月、&lt;http://www.rfc-editor.org/info/rfc4821&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC6555] Wing, D. and A. Yourtchenko, &#34;Happy Eyeballs: Success with Dual-Stack Hosts&#34;, RFC 6555, DOI 10.17487/RFC6555, April 2012, &lt;http://www.rfc-editor.org/info/rfc6555&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[RFC6555]ウイング、D.とA. Yourtchenko、 &#34;ハッピー眼球：デュアルスタックホストと成功&#34;、RFC 6555、DOI 10.17487 / RFC6555、2012年4月、&lt;http://www.rfc-editor.org/info/ rfc6555&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
[SCAPY] Scapy, &lt;http://www.secdev.org/projects/scapy/&gt;.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
【SCAPY] Scapy、&lt;http://www.secdev.org/projects/scapy/&gt;。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Acknowledgements
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
謝辞
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
The authors thank Marak Majkowsiki for contributing text, examples, and a very thorough review. The authors would like to thank Mark Andrews, Brian Carpenter, Nick Hilliard, and Ray Hunter, for review.
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
著者は、テキスト、例、および非常に徹底した見直しを貢献するためMarak Majkowsikiに感謝します。著者はレビューのために、マーク・アンドリュース、ブライアン・カーペンター、ニック・ヒリアード、およびレイハンターに感謝したいと思います。
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
Authors&#39; Addresses
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-0">
著者のアドレス
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Matt Byerly Fastly Kapolei, HI United States
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
マット・Byerlyしっかりカポレイ、ハワイ米国
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Email: suckawha@gmail.com
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
メール：suckawha@gmail.com
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Matt Hite Evernote Redwood City, CA United States
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
マット・ハイトEvernoteのレッドウッド・シティ、CA、米国
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Email: mhite@hotmail.com
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
メール：mhite@hotmail.com
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Joel Jaeggli Fastly Mountain View, CA United States
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
ジョエルJaeggliしっかりマウンテンビュー、CA、米国
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
Email: joelja@gmail.com
        </p>
      </div>
      <div class="col-sm-12 col-md-6">
        <p class="text indent-3">
メール：joelja@gmail.com
        </p>
      </div>
    </div>
  </div>
  <div id="rfc_footer"></div>
</body>
</html>
